Deleting Users

	1 - Add a new column on Users' table

		rails generate migration add_admin_to_users admin:boolean

	1.1 - Define a default value for admin, open the migrate file generated by the command above

		add_column :users, :admin, :boolean, default: false

	1.2 - Execute migration

		rake db:migrate

	2 - Modify the seeds.rb to the first user became a Admin, just add the admin attribute = true

	2.1 - Reset the database and feed it again

		rake db:migrate:reset
		rake db:seed

	3 - Modify the Users Helper - _user.html.erb and add these lines after link_to user.name and the part of gravatar

		link_to gravatar_for(user, size: 50), user	

		<% if current_user.admin? && !current_user?(user) %>
			| <%= link_to "delete", user, method: :delete, data: { confirm: "You sure?" }  %>
		<% end %>

	4 - Create the Destroy action on users_controller.rb

	  def destroy
	    User.find(params[:id]).destroy
	    flash[:success] = "User deleted"
	    redirect_to users_url
	  end

	4.1 - Modify the before_actions on top of file

		before_action :logged_in_user, only: [:index, :edit, :update, :destroy]
		before_action :correct_user, only: [:edit, :update]
		before_action :admin_user, only: :destroy

	4.2 - Create the admin_user private method:

		# Confirms an admin user
		def admin_user
			redirect_to(root_url) unless current_user.admin?
		end

	5 - Create a test for this new action

	5.1 - Modify the users.yml for your first user - adding the admin attribute e.g.:

		bruno:
    		name: Bruno Example
    		email: bruno@example.com
    		password_digest: <%= User.digest('password') %>
    		admin: true

    5.2 - Create 2 new tests on users_controller_test.rb

		test "should redirect destroy when not logged in" do
		assert_no_difference 'User.count' do
		  delete :destroy, id: @user
		end
		assert_redirected_to login_url
		end

		test "should redirect destroy when logged in as a non-admin" do
		log_in_as(@another_user)
		assert_no_difference 'User.count' do
		  delete :destroy, id: @user
		end
		assert_redirected_to root_url
		end

	5.3 - Change the users_index_test.rb, almost all the content was modified

		def setup
			@admin = users(:bruno)
		@non_admin = users(:archer)
		end

		test "index as admin including pagination and delete links" do
			log_in_as(@admin)
			get users_path
			assert_template 'users/index'
			assert_select 'div.pagination'
		first_page_of_users = User.paginate(page: 1)

			first_page_of_users.each do |user|
				assert_select 'a[href=?]', user_path(user), text: user.name
		  unless user == @admin
		    assert_select 'a[href=?]', user_path(user), text: 'delete', method: :delete        
		  end
			end
		assert_difference 'User.count', -1 do
		  delete user_path(@non_admin)
		end
		end

		test "index as non admin" do
		log_in_as(@non_admin)
		get users_path
		assert_select 'a', text: 'delete', count: 0
		end
